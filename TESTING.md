# Инструкции по тестированию HH Resume Exporter

## Шаги для установки и тестирования

### 1. Установка расширения в Chrome

1. Откройте Google Chrome
2. Перейдите в `chrome://extensions/`
3. Включите "Режим разработчика" (Developer mode) в правом верхнем углу
4. Нажмите "Загрузить распакованное расширение" (Load unpacked)
5. Выберите папку `src` из этого проекта
6. Расширение должно появиться в списке установленных

### 2. Настройка расширения

1. Нажмите на иконку расширения в панели инструментов браузера
2. Введите следующие данные:
   - **API Root**: `http://localhost:8000/api`
   - **API Token**: ваш токен авторизации из API
3. Нажмите "Сохранить и войти"
4. Если данные корректны, вы увидите информацию о сотруднике и компании

### 3. Тестирование на тестовой странице

1. Откройте тестовую страницу: `http://localhost:3000/test-page.html`
2. На странице должна появиться кнопка "Выгрузить!" рядом с именем
3. **Тестирование попапа**: Нажмите кнопку "Скачать резюме" - откроется попап с PDF ссылкой
4. Нажмите кнопку "Выгрузить!" для тестирования отправки данных
5. Расширение должно автоматически найти и нажать кнопку скачивания, затем извлечь PDF ссылку

### 4. Тестирование на реальном сайте hh.kz

1. Перейдите на любую страницу резюме на hh.kz
   - Например: `https://hh.kz/resume/12345678`
2. Кнопка "Выгрузить!" должна появиться на странице резюме
3. Нажмите на кнопку для отправки резюме в вашу систему

## Проверка функциональности

### Панель настроек

- ✅ Сохранение и загрузка настроек
- ✅ Отображение информации о сотруднике
- ✅ Информация о компании и подписке
- ✅ Статистика использования токена
- ✅ Кнопка выхода

### Экспорт резюме

- ✅ Извлечение имени кандидата
- ✅ Извлечение контактных данных
- ✅ Определение желаемой должности
- ✅ Поиск PDF файла резюме (несколько селекторов)
- ✅ **Обработка динамических попапов с PDF ссылками**
- ✅ **Автоматическое нажатие кнопок для открытия попапов**
- ✅ **MutationObserver для отслеживания изменений DOM**
- ✅ Загрузка PDF файлов с hh.kz
- ✅ Отправка данных в API
- ✅ Визуальная обратная связь с подробными статусами
- ✅ Обработка относительных и абсолютных URL

## Отладка

### Просмотр логов расширения

1. Откройте `chrome://extensions/`
2. Найдите HH Resume Exporter
3. Нажмите "Подробности" → "Проверить представления" → "Служебный исполнитель"
4. В открывшейся консоли будут видны логи расширения

### Проверка content script

1. На любой странице hh.kz нажмите F12
2. В консоли разработчика будут видны логи content script

### Проверка сетевых запросов

1. Откройте вкладку Network в DevTools
2. Нажмите кнопку экспорта резюме
3. Проверьте отправленные запросы к вашему API

## Возможные проблемы

### Кнопка не появляется

- Проверьте, что вы находитесь на странице резюме hh.kz
- Убедитесь, что расширение включено
- Проверьте консоль на наличие ошибок

### Ошибка авторизации

- Проверьте правильность API Root URL
- Убедитесь, что токен действителен
- Проверьте, что API сервер запущен

### Не отправляются данные

- Проверьте сетевые запросы в DevTools
- Убедитесь, что все обязательные поля заполнены
- Проверьте формат отправляемых данных

### PDF файл не загружается

- Убедитесь, что на странице есть ссылка на PDF
- Проверьте консоль на ошибки загрузки
- Проверьте, что ссылка доступна (не требует дополнительной авторизации)
- В DevTools → Network можете увидеть запросы на загрузку PDF

### Попап с PDF не открывается

- Проверьте, что расширение нашло кнопку для открытия попапа
- В консоли должны быть логи: "Found popup trigger button"
- Убедитесь, что кнопка скачивания доступна для клика
- Проверьте, что MutationObserver отслеживает изменения DOM

### Отладочные логи

Расширение выводит подробные логи в консоль:

- Найденные данные резюме
- Поиск кнопок для открытия попапа
- Процесс нажатия кнопки и ожидания попапа
- URL PDF файла
- Статус загрузки PDF
- Отправляемые данные

Для просмотра логов:

1. Откройте DevTools (F12)
2. Перейдите на вкладку Console
3. Нажмите кнопку экспорта резюме
4. Проследите логи выполнения

## Как работает поиск PDF в попапах

### Алгоритм поиска:

1. **Прямой поиск**: Сначала ищет уже существующие PDF ссылки на странице
2. **Поиск кнопки**: Если PDF ссылка не найдена, ищет кнопки для открытия попапа:
   - `[data-qa="resume-download-pdf"]`
   - `[data-qa="resume-actions-download"]`
   - Кнопки с текстом "PDF", "Скачать", "Download"
3. **Активация попапа**: Нажимает найденную кнопку
4. **Ожидание изменений**: Использует MutationObserver для отслеживания добавления новых элементов
5. **Извлечение ссылки**: Находит PDF ссылку в новом контенте
6. **Таймаут**: Если ссылка не найдена за 3 секунды, продолжает без PDF

### MutationObserver:

- Отслеживает добавление новых элементов в DOM
- Ищет PDF ссылки в новых элементах
- Автоматически отключается при нахождении ссылки
- Имеет таймаут 3 секунды для предотвращения бесконечного ожидания

## Структура отправляемых данных

Расширение отправляет следующие данные в формате multipart/form-data:

```
candidate_name: "Иванов Иван Иванович"
candidate_phone: "+7 700 123 45 67"
candidate_email: "ivan.ivanov@example.com"
position: "Frontend разработчик"
resume_file: [PDF файл, если доступен]
```

## Безопасность

- API токены хранятся в browser storage
- Все запросы отправляются с заголовком Authorization
- PDF файлы загружаются через безопасные запросы
- Данные не передаются третьим лицам
